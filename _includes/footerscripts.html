{% include signup-form.html %}

{% if page.permalink == 'index.html' %}
<script>
head.load(
  "{{ "/public/css/pegke-front.min.css" | prepend: site.baseurl }}",
  "{{ "/public/js/semanticjs.front.min.js" | prepend: site.baseurl }}"
);
head.ready(function () {
  $('#header').removeClass('box-shadow');
  $(window).scroll(function() {
    if ($(this).scrollTop() > 400) {
      $('#header').addClass('box-shadow');
    } else {
      $('#header').removeClass('box-shadow');
    }
  });
  if(! head.mobile) {
    $('#fullpage').fullpage({
      animateAnchor: true,
      scrollOverflow: true,
      navigationTooltips: ['Home', 'Benefits', 'Testimonials', 'Businesses', 'Contact'],
      navigation: true,
      navigationPosition: 'right',
      sectionsColor: ['#000', '#fff7c1', '#DEEEEB', 'ECF2F2', '#222222'],
    });
  }
});
</script>
{% elsif page.permalink == '/api/' %}
<script>
head.load(
  "{{ "/public/css/pegke-api.min.css" | prepend: site.baseurl }}",
  "{{ "/public/js/semanticjs.api.min.js" | prepend: site.baseurl }}"
);
head.ready(function () {
  $(document).ready(function() {
    $(".hashnav").scrollspy();
    $('.hashnav a').click(function() {
      $('.hashnav a').removeClass('active');
      $(this).addClass('active');
      $('html, body').animate({
        scrollTop: $($(this).attr('href')).offset().top - 80
      }, 200);
    });
  });
});
</script>
{% else %}
<script>
head.load(
  "{{ "/public/css/pegke-page.min.css" | prepend: site.baseurl }}",
  "{{ "/public/js/semanticjs.min.js" | prepend: site.baseurl }}"
);
</script>
{% endif %}

<script type="text/javascript">
head.ready(function () {
  $('.cta, .ctal').click(function() {
    $('.ui.modal.signup').modal('show');
  });
  var apiBaseurl = '{{site.dashboard.api_bases}}';
  $.fn.api.settings.api = {
    'signup'  : apiBaseurl + 'api/mobileuser/vendor_registration',
    'support' : apiBaseurl + 'api/contact_us',
    'registermobile'  : apiBaseurl + 'api/mobileuser/register'
  };

  $(document).ready(function() {
    $('.costs button').click(function() {
      $('.costs button').removeClass('positive');
      var selcur = $(this).attr('data-curr');
      $(this).addClass('positive');
      console.log(selcur);
      if( selcur == 'usd' ) {
        $('.currency').text('$');
        animateUpdate(1.60, 0.025, 3, 'amt');
      } else if( selcur == 'inr' ) {
        $('.currency').text('â‚¹');
        animateUpdate(0.025, 1.60, 2, 'amt');
      }
    });

    if ($('#pegkestat').length) {
      var dt = new Date();
      $.getJSON("https://dashboard.pegke.com/?q=api/pegke_status", function( data ) {
        console.log(data);
        $('#lstmod').text(dt);
        var items = [];
        $.each( data.sstatus, function( key, val) {

          items.push( '<div class="item"> \
          <div class="right floated content"> \
          <div class="ui tiny green label">' + val + '</div> \
          </div> <i class="check large green icon"></i> \
          <div class="content">' + key + '</div></div>' );
        });

        $( "<div/>", {
          "class": "ui middle aligned divided list",
          html: items.join( "" )
        }).appendTo( "#pegkestat" );
        $('#lstmod').html(data.last_mod);
        $('#pegkestat').removeClass('loading');
      });
    }

    function animateUpdate(fromVal, toVal, roundVal, elm) {
      jQuery({ Counter: 0 }).animate({ Counter: toVal }, {
        duration: 1000,
        easing: 'swing',
        step: function () {
          $('.'+ elm).text(parseFloat(this.Counter).toFixed(roundVal));
        }
      });
    }
    var pathname = window.location.pathname;
    var desired = pathname.replace(/[^\w\s]/gi, '')
    $(".menu.right a, .mobilemenu a, .footer").each(function(index) {
      var ahref = ($(this).attr('href')) ? $(this).attr('href') : 'not';
      var thishref = ahref.replace(/[^\w\s]/gi, '');
      if (desired === thishref ) {
        $(this).addClass("active");
      }
    });
  });

  $('.menu .item').tab();

  $('.ui.dropdown').dropdown();
  $('.ui.checkbox').checkbox();
  $('.ui.accordion').accordion();
  $('.ui.sticky')
  .sticky({
    context: '#context',
    offset: 75
  });

  $('.special.card .image').dimmer({
    on: 'hover'
  });

  // $('.ui.label').popup();
  $('.rupee.icon').popup();
  $('.feature-list .item').popup();
  $('.tstack').popup();
  $('.ui.rating').rating();
  // setInterval(function(){
  //   $('.shape').shape('flip over');
  // }, 3000);
  $('#merchantregn')
  .form({
    fields: {
      name: {
        identifier: 'field_name[und][0][value]',
        rules: [{
          type: 'empty',
          prompt: 'Please enter your name'
        }]
      },
      phone: {
        identifier: 'field_contact_number[und][0][value]',
        rules: [{
          type: 'regExp[/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im]',
          prompt: 'Please check the format'
        }]
      },
      country: {
        identifier: 'locations[0][country]',
        rules: [{
          type: 'empty',
          prompt: 'Please chose your country'
        }]
      },
      passone: {
        identifier: 'passone',
        rules: [{
          type   : 'empty',
          prompt : 'Please enter a password'
        },
        {
          type   : 'minLength[6]',
          prompt : 'Your password must be at least {ruleValue} characters'
        }]
      },
      pass: {
        identifier: 'pass',
        rules: [{
          type   : 'empty',
          prompt : 'Please enter a password'
        },
        {
          type: 'match[passone]',
          prompt: 'Please cross check your passwords'
        }]
      },
      email: {
        identifier: 'mail',
        rules: [{
          type: 'email',
          prompt : 'Please enter a valid e-mail'
        }]
      },
      city: {
        identifier: 'locations[0][city]',
        rules: [{
          type: 'empty',
          prompt: 'Please enter your city'
        }]
      }
    },
    on : 'blur'
  })
  .api({
    method: 'post',
    action: 'signup',
    serializeForm: true,
    dataType: 'json',
    onResponse: function (response) {
      console.log(response);
    },
    onError: function(errorMessage) {
      console.log(errorMessage);
    },
  });

  $('#support')
  .form({
    fields: {
      email: {
        identifier: 'email',
        rules: [{
          type: 'email',
          prompt : 'Please enter a valid e-mail'
        }]
      },
      details: {
        identifier: 'details',
        rules: [{
          type: 'empty',
          prompt: 'Tell us your concern !!'
        }]
      },
    }
  })
  .api({
    method: 'post',
    action: 'support',
    serializeForm: true,
    dataType: 'json',
    onResponse: function (response) {
      $('form#support')[0].reset();
      $('form#support').fadeOut();
      $('#afterContact').removeClass('ohidden');
    }
  });

  $('#sg-sup-form')
  .form({
    fields: {
      email: {
        identifier: 'sg-email',
        rules: [{
          type: 'email',
          prompt : 'Please enter a valid e-mail'
        }]
      }
    }
  })
  .api({
    method: 'post',
    action: 'registermobile'
  });

  $('.step .image, .stack .image, .lazy')
  .visibility({
    type       : 'image',
    transition : 'pulse',
    duration   : 1000
  })
  ;
  $('#hamb').click(function() {
    $('.ui.submenu.modal')
    .modal('show');
  });

  $('#sg-signup').click(function() {
    $(this).addClass('loading');
    $('#sg-email').attr('disabled', "true");

    setTimeout(function() {
      $('#sg-signup').removeClass('loading');
      $('#sg-email').removeAttr('disabled');
      $('#sg-msg').text('thanks...').removeClass('ohidden');
    }, 3000);

  });

  $('#checkpoints')
  .form({
    fields: {
      phone: {
        identifier: 'phone',
        rules: [{
          type: 'empty',
        }, {
          type: 'exactLength[10]',
        }, {
          type: 'number',
        }]
      },
      country: {
        identifier: 'country',
        rules: [{
          type: 'empty',
          prompt: 'Please chose your country'
        }]
      },
    }
  });
});
</script>
<script src="https://linked.chat/web/6gdw5e" async></script>
<script>
jQuery(window).bind("load", function () {
  jQuery('.overlayp').remove();
  jQuery('.menu.widescreen .nexth').after('<a href="{{site.dashboard.base_url}}" class="item ui button red ml">MERCHANT LOG IN</a>');
});
</script>
<script>(function(G,o,O,g,l){G.GoogleAnalyticsObject=O;G[O]||(G[O]=function(){(G[O].q=G[O].q||[]).push(arguments)});G[O].l=+new Date;g=o.createElement('script'),l=o.scripts[0];g.src='https://www.google-analytics.com/analytics.js';l.parentNode.insertBefore(g,l)}(this,document,'ga'));ga('create', 'UA-38015473-1', 'pegke.com');ga('require', 'displayfeatures');ga('set', '&uid', 0);ga('send', 'pageview')</script>
